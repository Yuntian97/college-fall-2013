<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=None">
  <style type="text/css">
td.linenos { background-color: #f0f0f0; padding-right: 10px; }
span.lineno { background-color: #f0f0f0; padding: 0 5px 0 5px; }
pre { line-height: 125%; }
body .hll { background-color: #ffffcc }
body  { background: #f8f8f8; }
body .c { color: #408080; font-style: italic } /* Comment */
body .err { border: 1px solid #FF0000 } /* Error */
body .k { color: #008000; font-weight: bold } /* Keyword */
body .o { color: #666666 } /* Operator */
body .cm { color: #408080; font-style: italic } /* Comment.Multiline */
body .cp { color: #BC7A00 } /* Comment.Preproc */
body .c1 { color: #408080; font-style: italic } /* Comment.Single */
body .cs { color: #408080; font-style: italic } /* Comment.Special */
body .gd { color: #A00000 } /* Generic.Deleted */
body .ge { font-style: italic } /* Generic.Emph */
body .gr { color: #FF0000 } /* Generic.Error */
body .gh { color: #000080; font-weight: bold } /* Generic.Heading */
body .gi { color: #00A000 } /* Generic.Inserted */
body .go { color: #888888 } /* Generic.Output */
body .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
body .gs { font-weight: bold } /* Generic.Strong */
body .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
body .gt { color: #0044DD } /* Generic.Traceback */
body .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
body .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
body .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
body .kp { color: #008000 } /* Keyword.Pseudo */
body .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
body .kt { color: #B00040 } /* Keyword.Type */
body .m { color: #666666 } /* Literal.Number */
body .s { color: #BA2121 } /* Literal.String */
body .na { color: #7D9029 } /* Name.Attribute */
body .nb { color: #008000 } /* Name.Builtin */
body .nc { color: #0000FF; font-weight: bold } /* Name.Class */
body .no { color: #880000 } /* Name.Constant */
body .nd { color: #AA22FF } /* Name.Decorator */
body .ni { color: #999999; font-weight: bold } /* Name.Entity */
body .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
body .nf { color: #0000FF } /* Name.Function */
body .nl { color: #A0A000 } /* Name.Label */
body .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
body .nt { color: #008000; font-weight: bold } /* Name.Tag */
body .nv { color: #19177C } /* Name.Variable */
body .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
body .w { color: #bbbbbb } /* Text.Whitespace */
body .mf { color: #666666 } /* Literal.Number.Float */
body .mh { color: #666666 } /* Literal.Number.Hex */
body .mi { color: #666666 } /* Literal.Number.Integer */
body .mo { color: #666666 } /* Literal.Number.Oct */
body .sb { color: #BA2121 } /* Literal.String.Backtick */
body .sc { color: #BA2121 } /* Literal.String.Char */
body .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
body .s2 { color: #BA2121 } /* Literal.String.Double */
body .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
body .sh { color: #BA2121 } /* Literal.String.Heredoc */
body .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
body .sx { color: #008000 } /* Literal.String.Other */
body .sr { color: #BB6688 } /* Literal.String.Regex */
body .s1 { color: #BA2121 } /* Literal.String.Single */
body .ss { color: #19177C } /* Literal.String.Symbol */
body .bp { color: #008000 } /* Name.Builtin.Pseudo */
body .vc { color: #19177C } /* Name.Variable.Class */
body .vg { color: #19177C } /* Name.Variable.Global */
body .vi { color: #19177C } /* Name.Variable.Instance */
body .il { color: #666666 } /* Literal.Number.Integer.Long */

  </style>
</head>
<body>
<h2></h2>

<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic">/*</span>
<span style="color: #408080; font-style: italic"> * Hi!</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * This DBMS was designed to allow a developer to swap out RecordFormat and</span>
<span style="color: #408080; font-style: italic"> * PageFormat. This allows someone to customize how the DBMS stores Records and</span>
<span style="color: #408080; font-style: italic"> * how Records are stored in each Page.</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * This abstraction is done through the Strategy design pattern, where an</span>
<span style="color: #408080; font-style: italic"> * algorithm is abstracted out into another class to allow swapping at runtime.</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * Everything else should be self explanatory, it is just very rigid pseudocode</span>
<span style="color: #408080; font-style: italic"> * (some things are missing) but I tried to be explicit as possible.</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * Hopefully it&#39;s easy to read, I tried to add Java Docs to help with that.</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * Let me know if you need any help!</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * - Josh</span>
<span style="color: #408080; font-style: italic"> */</span>

<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Main interface to the DBMS.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">AccessManager</span> <span style="color: #008000; font-weight: bold">implements</span> AccessManagerInterface <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/** Name of the database. */</span>
    <span style="color: #008000; font-weight: bold">private</span> String dbName<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** List of tables in the database. */</span>
    <span style="color: #008000; font-weight: bold">private</span> HashMap<span style="color: #666666">&lt;</span>String<span style="color: #666666">,</span> Table<span style="color: #666666">&gt;</span> tables<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** The PageFormat to use when placing a Record into a Page. */</span>
    <span style="color: #008000; font-weight: bold">private</span> PageFormat pageFormat<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** The RecordFormat to use when writing a Record. */</span>
    <span style="color: #008000; font-weight: bold">private</span> RecordFormat recordFormat<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Creates a new AccessManager.</span>
<span style="color: #408080; font-style: italic">     * @param givenDbName Database info to access.</span>
<span style="color: #408080; font-style: italic">     * @param givenPageFormat PageFormat to access.</span>
<span style="color: #408080; font-style: italic">     * @param givenRecordFormat RecordFormat to access.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #0000FF">AccessManager</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String givenDbName<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> PageFormat givenPageFormat<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> RecordFormat givenRecordFormat<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">// Read in all the information from the first Page</span>
        Page page <span style="color: #666666">=</span> DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">readPage</span><span style="color: #666666">(0);</span>

        <span style="color: #408080; font-style: italic">//</span>
        <span style="color: #408080; font-style: italic">// Here we would read in all the serialized information regarding the</span>
        <span style="color: #408080; font-style: italic">// database schema such as the list of tables in the database which</span>
        <span style="color: #408080; font-style: italic">// contains all the mapping information and so on...</span>
        <span style="color: #408080; font-style: italic">//</span>

        <span style="color: #408080; font-style: italic">// Assign constructor values</span>
        dbName <span style="color: #666666">=</span> givenDbName<span style="color: #666666">;</span>
        pageFormat <span style="color: #666666">=</span> givenPageFormat<span style="color: #666666">;</span>
        recordFormat <span style="color: #666666">=</span> givenRecordFormat<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Creates a new Table.</span>
<span style="color: #408080; font-style: italic">     * @param tableName Name of the new table.</span>
<span style="color: #408080; font-style: italic">     * @param fields Array of Fields to use.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">createTable</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String tableName<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> Field<span style="color: #666666">[]</span> fields<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        Table table <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> Table<span style="color: #666666">(</span>fields<span style="color: #666666">,</span> pageFormat<span style="color: #666666">,</span> recordFormat<span style="color: #666666">);</span>

        tables<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>tableName<span style="color: #666666">,</span> table<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Checks whether a table exists in the database.</span>
<span style="color: #408080; font-style: italic">     * @param tableName Name of the table.</span>
<span style="color: #408080; font-style: italic">     * @return True or false depending on the existence of the table.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">boolean</span> <span style="color: #0000FF">tableExists</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String tableName<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> tables<span style="color: #666666">.</span><span style="color: #7D9029">contains</span><span style="color: #666666">(</span>tableName<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Deletes a table.</span>
<span style="color: #408080; font-style: italic">     * @param tableName Name of the table to delete.</span>
<span style="color: #408080; font-style: italic">     * @throws DBMSException on any error.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">deleteTable</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String tableName<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> DBMSException <span style="color: #666666">{</span>
        Table table <span style="color: #666666">=</span> getTable<span style="color: #666666">(</span>tableName<span style="color: #666666">);</span>

        table<span style="color: #666666">.</span><span style="color: #7D9029">delete</span><span style="color: #666666">();</span>

        <span style="color: #408080; font-style: italic">// Remove from the list of tables</span>
        tables<span style="color: #666666">.</span><span style="color: #7D9029">remove</span><span style="color: #666666">(</span>tableName<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Reads and returns a record.</span>
<span style="color: #408080; font-style: italic">     * @param tableName Name of the table to search.</span>
<span style="color: #408080; font-style: italic">     * @param rid Record ID to read.</span>
<span style="color: #408080; font-style: italic">     * @return The record that matches the ID given.</span>
<span style="color: #408080; font-style: italic">     * @throws DBMSException on any error.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> Record <span style="color: #0000FF">readRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String tableName<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> DBMSException <span style="color: #666666">{</span>
        Table table <span style="color: #666666">=</span> getTable<span style="color: #666666">(</span>tableName<span style="color: #666666">);</span>

        <span style="color: #008000; font-weight: bold">return</span> table<span style="color: #666666">.</span><span style="color: #7D9029">readRecord</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Writes a given Record to its Table.</span>
<span style="color: #408080; font-style: italic">     * @param tableName Name of the table.</span>
<span style="color: #408080; font-style: italic">     * @param rid ID of the Record.</span>
<span style="color: #408080; font-style: italic">     * @param record Record to write.</span>
<span style="color: #408080; font-style: italic">     * @throws DBMSException on any error.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">writeRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String tableName<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> Record record<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> DBMSException <span style="color: #666666">{</span>
        Table table <span style="color: #666666">=</span> getTable<span style="color: #666666">(</span>tableName<span style="color: #666666">);</span>

        table<span style="color: #666666">.</span><span style="color: #7D9029">writeRecord</span><span style="color: #666666">(</span>rid<span style="color: #666666">,</span> record<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Deletes a record.</span>
<span style="color: #408080; font-style: italic">     * @param tableName Name of the table.</span>
<span style="color: #408080; font-style: italic">     * @param rid Record ID to delete.</span>
<span style="color: #408080; font-style: italic">     * @throws DBMSException on any error.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">deleteRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String tableName<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> DBMSException <span style="color: #666666">{</span>
        Table table <span style="color: #666666">=</span> getTable<span style="color: #666666">(</span>tableName<span style="color: #666666">);</span>

        table<span style="color: #666666">.</span><span style="color: #7D9029">deleteRecord</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Sets the RecordFormat when serializing it.</span>
<span style="color: #408080; font-style: italic">     * @param format RecordFormat to use.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">setRecordFormat</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> RecordFormat format<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        recordFormat <span style="color: #666666">=</span> format<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Sets the PageFormat for when saving a Record to a Page.</span>
<span style="color: #408080; font-style: italic">     * @param format PageFormat to use.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">setPageFormat</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> PageFormat format<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        pageFormat <span style="color: #666666">=</span> format<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Closes the database to ensure everything is saved.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">close</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">// Write all schema and mapping from records to pages to the first</span>
        <span style="color: #408080; font-style: italic">// Page.</span>
        ByteArrayOutputStream out <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> ByteArrayOutputStream<span style="color: #666666">();</span>
        ObjectOutputStream serializer <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> ObjectOutputStream<span style="color: #666666">(</span>out<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Contains mapping from Database to Tables</span>
        serializer<span style="color: #666666">.</span><span style="color: #7D9029">writeObject</span><span style="color: #666666">(</span>db<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Contains mapping from Tables to Pages + Field info</span>
        serializer<span style="color: #666666">.</span><span style="color: #7D9029">writeObject</span><span style="color: #666666">(</span>tables<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Close serializer</span>
        serializer<span style="color: #666666">.</span><span style="color: #7D9029">close</span><span style="color: #666666">();</span>

        <span style="color: #408080; font-style: italic">// Read the first Page into memory.</span>
        Page page <span style="color: #666666">=</span> DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">readPage</span><span style="color: #666666">(0);</span>

        <span style="color: #408080; font-style: italic">// Write the Database information to it</span>
        page<span style="color: #666666">.</span><span style="color: #7D9029">writeBytes</span><span style="color: #666666">(</span>out<span style="color: #666666">.</span><span style="color: #7D9029">toByteArray</span><span style="color: #666666">());</span>

        <span style="color: #408080; font-style: italic">// Write it back to disk</span>
        DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">writePage</span><span style="color: #666666">(0,</span> page<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Clean up</span>
        out<span style="color: #666666">.</span><span style="color: #7D9029">close</span><span style="color: #666666">();</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Helper to check if a table exists and return it.</span>
<span style="color: #408080; font-style: italic">     * @param name Name of the table.</span>
<span style="color: #408080; font-style: italic">     * @return Table that matches.</span>
<span style="color: #408080; font-style: italic">     * @throws DBMSException on any error.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">private</span> Table <span style="color: #0000FF">getTable</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String name<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> DBMSException <span style="color: #666666">{</span>
        Table table <span style="color: #666666">=</span> tables<span style="color: #666666">.</span><span style="color: #7D9029">get</span><span style="color: #666666">(</span>tableName<span style="color: #666666">);</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>table <span style="color: #666666">==</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">)</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #0000FF">DBMSException</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;Table &quot;</span> <span style="color: #666666">+</span> tableName <span style="color: #666666">+</span> <span style="color: #BA2121">&quot; does not exist.&quot;</span><span style="color: #666666">);</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">return</span> table<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Exception to throw in this DBMS implementation.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">DBMSException</span> <span style="color: #008000; font-weight: bold">extends</span> Exception <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Throw an Exception with the given message.</span>
<span style="color: #408080; font-style: italic">     * @param msg Message to throw.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #0000FF">DBMSException</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String msg<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">super</span><span style="color: #666666">(</span>msg<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Class that abstracts away the disk management operations in the DBMS.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">static</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">DiskManager</span> <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Creates and returns a new Page.</span>
<span style="color: #408080; font-style: italic">     * @return The new Page.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">final</span> Page <span style="color: #0000FF">createPage</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Deletes a Page.</span>
<span style="color: #408080; font-style: italic">     * @param pid Page id to delete.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">deletePage</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> pid<span style="color: #666666">)</span> <span style="color: #666666">{</span> <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Write a Page to disk.</span>
<span style="color: #408080; font-style: italic">     * @param pid Page ID to write.</span>
<span style="color: #408080; font-style: italic">     * @param page Page to write.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">writePage</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> pid<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">final</span> Page page<span style="color: #666666">)</span> <span style="color: #666666">{</span> <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Reads a Page from disk.</span>
<span style="color: #408080; font-style: italic">     * @param pid Page ID to read.</span>
<span style="color: #408080; font-style: italic">     * @return Page that was read.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">final</span> Page <span style="color: #0000FF">readPage</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> pid<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">null</span><span style="color: #666666">;</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Field class for the DBMS.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Field</span> <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/** Name of the field. */</span>
    <span style="color: #008000; font-weight: bold">private</span> String name<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** SQL Type of the field. */</span>
    <span style="color: #008000; font-weight: bold">private</span> String type<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Optional variable size of the field. */</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> variableSize<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Basic constructor for a Field.</span>
<span style="color: #408080; font-style: italic">     * @param givenName Name of the Field.</span>
<span style="color: #408080; font-style: italic">     * @param givenType Type of the Field.</span>
<span style="color: #408080; font-style: italic">     * @param givenSize Size of the Field.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #0000FF">Field</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> String givenName<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> String givenType<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> givenSize<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">// Assign constructor values</span>
        name <span style="color: #666666">=</span> givenName<span style="color: #666666">;</span>
        type <span style="color: #666666">=</span> givenType<span style="color: #666666">;</span>
        size <span style="color: #666666">=</span> givenSize<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Getter for the Field name.</span>
<span style="color: #408080; font-style: italic">     * @return Name of the Field.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> String <span style="color: #0000FF">getName</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> name<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Getter for the Field type.</span>
<span style="color: #408080; font-style: italic">     * @return Type of the Field.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> String <span style="color: #0000FF">getType</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> type<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Getter for the size of the field.</span>
<span style="color: #408080; font-style: italic">     * @return Size of the field.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> <span style="color: #0000FF">getSize</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span><span style="color: #BA2121">&quot;int&quot;</span><span style="color: #666666">.</span><span style="color: #7D9029">equals</span><span style="color: #666666">(</span>type<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">4;</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span><span style="color: #BA2121">&quot;varchar&quot;</span><span style="color: #666666">.</span><span style="color: #7D9029">equals</span><span style="color: #666666">(</span>type<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">return</span> variableSize<span style="color: #666666">;</span>
        <span style="color: #666666">}</span>
        <span style="color: #408080; font-style: italic">// ..</span>
        <span style="color: #408080; font-style: italic">// continued...</span>
        <span style="color: #408080; font-style: italic">// ..</span>
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            <span style="color: #408080; font-style: italic">// and so on...</span>
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0;</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Implementation of RecordFormat for fixed record format.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">FixedRecordFormat</span> <span style="color: #008000; font-weight: bold">implements</span> RecordFormat <span style="color: #666666">{</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> <span style="color: #0000FF">writeRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> Record record<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #B00040">int</span> length <span style="color: #666666">=</span> <span style="color: #666666">0;</span>

        <span style="color: #408080; font-style: italic">// Find the length of all Fields</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>Field field <span style="color: #666666">:</span> record<span style="color: #666666">.</span><span style="color: #7D9029">getFields</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            length <span style="color: #666666">+=</span> field<span style="color: #666666">.</span><span style="color: #7D9029">getSize</span><span style="color: #666666">();</span>
        <span style="color: #666666">}</span>

        <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> result <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">byte</span><span style="color: #666666">[</span>length<span style="color: #666666">];</span>

        <span style="color: #408080; font-style: italic">// Write all the Field values to the result byte array</span>
        <span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0,</span> field <span style="color: #666666">=</span> <span style="color: #666666">0;</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>Field field <span style="color: #666666">:</span> record<span style="color: #666666">.</span><span style="color: #7D9029">getFields</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            <span style="color: #408080; font-style: italic">// writeBytes(result, i, field.getSize(), record.getValue(field));</span>
            field <span style="color: #666666">+=</span> <span style="color: #666666">1;</span>
            i <span style="color: #666666">+=</span> field<span style="color: #666666">.</span><span style="color: #7D9029">getSize</span><span style="color: #666666">();</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">return</span> result<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> Record <span style="color: #0000FF">readRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> Field<span style="color: #666666">[]</span> fields<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> bytes<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        Record result <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> Record<span style="color: #666666">(</span>fields<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Extract all the values from the given byte array into the Record</span>
        <span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0,</span> field <span style="color: #666666">=</span> <span style="color: #666666">0;</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>Field field <span style="color: #666666">:</span> fields<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            Object value<span style="color: #666666">;</span>
            <span style="color: #408080; font-style: italic">// value = readValue(i, field.getSize(), field.getType());</span>
            i <span style="color: #666666">+=</span> field<span style="color: #666666">.</span><span style="color: #7D9029">getSize</span><span style="color: #666666">();</span>
            record<span style="color: #666666">.</span><span style="color: #7D9029">setField</span><span style="color: #666666">(</span>field<span style="color: #666666">,</span> value<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">return</span> result<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * PageFormat for packing in the Records.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">PackedPageFormat</span> <span style="color: #008000; font-weight: bold">implements</span> PageFormat <span style="color: #666666">{</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> <span style="color: #0000FF">writeRecords</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[][]</span> recordBytes<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #B00040">int</span> length <span style="color: #666666">=</span> <span style="color: #666666">0;</span>
        <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> result<span style="color: #666666">;</span>

        <span style="color: #408080; font-style: italic">// Calculate the length of the entire Page</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span><span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0;</span> i <span style="color: #666666">&lt;</span> recordBytes<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span> i <span style="color: #666666">+=</span> <span style="color: #666666">1)</span> <span style="color: #666666">{</span>
            length <span style="color: #666666">+=</span> recordBytes<span style="color: #666666">[</span>i<span style="color: #666666">].</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span>
        <span style="color: #666666">}</span>

        result <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">byte</span><span style="color: #666666">[</span>length<span style="color: #666666">];</span>

        <span style="color: #408080; font-style: italic">// Copy the bytes from the given Record bytes into the final byte array</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span><span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0,</span> j <span style="color: #666666">=</span> <span style="color: #666666">0;</span> i <span style="color: #666666">&lt;</span> recordBytes<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span> i <span style="color: #666666">+=</span> <span style="color: #666666">1)</span> <span style="color: #666666">{</span>
            <span style="color: #408080; font-style: italic">// copyBytes(result, j, recordBytes[i]);</span>
            j <span style="color: #666666">+=</span> recordBytes<span style="color: #666666">[</span>i<span style="color: #666666">].</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">return</span> result<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #AA22FF">@Override</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[][]</span> <span style="color: #0000FF">readRecords</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> bytes<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> nRecords<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> recordLength<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #B00040">byte</span><span style="color: #666666">[][]</span> result <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> <span style="color: #B00040">byte</span><span style="color: #666666">[</span>nRecords<span style="color: #666666">][</span>recordLength<span style="color: #666666">];</span>

        <span style="color: #408080; font-style: italic">// Read the bytes from the given byte array into the corresponding</span>
        <span style="color: #408080; font-style: italic">// Record byte array</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span><span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0;</span> i <span style="color: #666666">&lt;</span> recordBytes<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span> i <span style="color: #666666">+=</span> <span style="color: #666666">1)</span> <span style="color: #666666">{</span>
            <span style="color: #408080; font-style: italic">// readBytes(result[i], bytes, i * recordLength, recordLength);</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">return</span> result<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Page class for DBMS.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Page</span> <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/** Page ID. */</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> pid<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Size of the Page. */</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> pageSize<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Page Format. */</span>
    <span style="color: #008000; font-weight: bold">private</span> PageFormat pageFormat<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Record Format. */</span>
    <span style="color: #008000; font-weight: bold">private</span> RecordFormat recordFormat<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Number of Records. */</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> nRecords<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Length of a Record. */</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> recordLength<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Given data. */</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> data<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Records in the Page. */</span>
    <span style="color: #008000; font-weight: bold">private</span> Records<span style="color: #666666">[]</span> records<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Fields in each Record. */</span>
    <span style="color: #008000; font-weight: bold">private</span> Fields<span style="color: #666666">[]</span> fields<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Creates a Page.</span>
<span style="color: #408080; font-style: italic">     * @param givenFields Fields of the Record.</span>
<span style="color: #408080; font-style: italic">     * @param givenData Data to initialize with.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #0000FF">Page</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> Field<span style="color: #666666">[]</span> givenFields<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> givenData<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        fields <span style="color: #666666">=</span> givenFields<span style="color: #666666">;</span>
        data <span style="color: #666666">=</span> givenData<span style="color: #666666">;</span>

        <span style="color: #B00040">byte</span><span style="color: #666666">[][]</span> recordBytes <span style="color: #666666">=</span> pageFormat<span style="color: #666666">.</span><span style="color: #7D9029">readRecords</span><span style="color: #666666">(</span>data<span style="color: #666666">,</span> nRecords<span style="color: #666666">,</span> recordLength<span style="color: #666666">);</span>

        records <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">new</span> Records<span style="color: #666666">[</span>recordBytes<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">];</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span><span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0;</span> i <span style="color: #666666">&lt;</span> recordBytes<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span> i <span style="color: #666666">+=</span> <span style="color: #666666">1)</span> <span style="color: #666666">{</span>
            Record record <span style="color: #666666">=</span> recordFormat<span style="color: #666666">.</span><span style="color: #7D9029">readRecord</span><span style="color: #666666">(</span>fields<span style="color: #666666">,</span> recordBytes<span style="color: #666666">[</span>i<span style="color: #666666">]);</span>
            records<span style="color: #666666">[</span>i<span style="color: #666666">]</span> <span style="color: #666666">=</span> record<span style="color: #666666">;</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Set the Page ID.</span>
<span style="color: #408080; font-style: italic">     * @param givenPid New Page ID.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">setPageID</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> givenPid<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        pid <span style="color: #666666">=</span> givenPid<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Getter for the Page ID.</span>
<span style="color: #408080; font-style: italic">     * @return The Page ID.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> <span style="color: #0000FF">getPageID</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> pid<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Sets the PageFormat.</span>
<span style="color: #408080; font-style: italic">     * @param format PageFormat to set.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">setPageFormat</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> PageFormat format<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        pageFormat <span style="color: #666666">=</span> format<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Sets the RecordFormat.</span>
<span style="color: #408080; font-style: italic">     * @param format RecordFormat to set.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">setRecordFormat</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> RecordFormat format<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        recordFormat <span style="color: #666666">=</span> format<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Return the number of records in the Page.</span>
<span style="color: #408080; font-style: italic">     * @return Number of records.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> <span style="color: #0000FF">countRecords</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> nRecords<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Returns if the Record is full or not.</span>
<span style="color: #408080; font-style: italic">     * @return True or False depending on full.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">boolean</span> <span style="color: #0000FF">isFull</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #B00040">int</span> count <span style="color: #666666">=</span> <span style="color: #666666">0;</span>

        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span><span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0;</span> i <span style="color: #666666">&lt;</span> recordBytes<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span> i <span style="color: #666666">+=</span> <span style="color: #666666">1)</span> <span style="color: #666666">{</span>
            count <span style="color: #666666">+=</span> recordBytes<span style="color: #666666">[</span>i<span style="color: #666666">].</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>count <span style="color: #666666">+</span> recordLength <span style="color: #666666">&gt;</span> pageSize<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">false</span><span style="color: #666666">;</span>
        <span style="color: #008000; font-weight: bold">else</span> <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000; font-weight: bold">true</span><span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Retrieve the given Record ID.</span>
<span style="color: #408080; font-style: italic">     * @param rid Record ID.</span>
<span style="color: #408080; font-style: italic">     * @return Record with the given Record ID.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> Record <span style="color: #0000FF">retrieveRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>Record record <span style="color: #666666">:</span> records<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>record<span style="color: #666666">.</span><span style="color: #7D9029">getRecordID</span><span style="color: #666666">()</span> <span style="color: #666666">==</span> rid<span style="color: #666666">)</span> <span style="color: #666666">{</span>
                <span style="color: #008000; font-weight: bold">return</span> record<span style="color: #666666">;</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #0000FF">DBMSException</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;Table does not contain record &quot;</span> <span style="color: #666666">+</span> rid<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Interface for arranging a series of Records on a Page.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">interface</span> <span style="color: #0000FF; font-weight: bold">PageFormat</span> <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Writes an array of Record bytes to a Page.</span>
<span style="color: #408080; font-style: italic">     * @param recordBytes Record to write.</span>
<span style="color: #408080; font-style: italic">     * @return Array of bytes.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> <span style="color: #0000FF">writeRecords</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[][]</span> recordBytes<span style="color: #666666">);</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Reads Record bytes from an array of bytes.</span>
<span style="color: #408080; font-style: italic">     * @param bytes Array of bytes to read.</span>
<span style="color: #408080; font-style: italic">     * @param nRecords Number of Records in the Page.</span>
<span style="color: #408080; font-style: italic">     * @param recordLength Length of each Record.</span>
<span style="color: #408080; font-style: italic">     * @return Array of Record bytes.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #B00040">byte</span><span style="color: #666666">[][]</span> <span style="color: #0000FF">readRecords</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> bytes<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> nRecords<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> recordLength<span style="color: #666666">);</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Record class for the DBMS.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Record</span> <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/** Record ID. */</span>
    <span style="color: #008000; font-weight: bold">private</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** All the Fields of a Record. */</span>
    <span style="color: #008000; font-weight: bold">private</span> Fields<span style="color: #666666">[]</span> fields<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Values of a Record. */</span>
    <span style="color: #008000; font-weight: bold">private</span> Objects<span style="color: #666666">[]</span> values<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Get the Record ID.</span>
<span style="color: #408080; font-style: italic">     * @return Record ID.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> <span style="color: #0000FF">getRecordID</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> rid<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Get all the Fields.</span>
<span style="color: #408080; font-style: italic">     * @return All the Fields.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> Fields<span style="color: #666666">[]</span> <span style="color: #0000FF">getFields</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> fields<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Get the Field at a given index.</span>
<span style="color: #408080; font-style: italic">     * @param i Index to get.</span>
<span style="color: #408080; font-style: italic">     * @return Field at the index.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> Field <span style="color: #0000FF">getField</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> i<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> fields<span style="color: #666666">[</span>i<span style="color: #666666">];</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Get the value at a given index.</span>
<span style="color: #408080; font-style: italic">     * @param i Index to get.</span>
<span style="color: #408080; font-style: italic">     * @return Value at the index.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> Object <span style="color: #0000FF">getValue</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> i<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">return</span> values<span style="color: #666666">[</span>i<span style="color: #666666">];</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Sets a field to a given value.</span>
<span style="color: #408080; font-style: italic">     * @param givenField Field to set.</span>
<span style="color: #408080; font-style: italic">     * @param value Value to set.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">setField</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> Field givenField<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> Object value<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">// Find the corresponding field index</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span><span style="color: #B00040">int</span> i <span style="color: #666666">=</span> <span style="color: #666666">0;</span> i <span style="color: #666666">&lt;</span> fields<span style="color: #666666">.</span><span style="color: #7D9029">length</span><span style="color: #666666">;</span> i <span style="color: #666666">+=</span> <span style="color: #666666">1)</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>field<span style="color: #666666">.</span><span style="color: #7D9029">equals</span><span style="color: #666666">(</span>givenField<span style="color: #666666">))</span> <span style="color: #666666">{</span>
                <span style="color: #008000; font-weight: bold">break</span><span style="color: #666666">;</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>

        <span style="color: #408080; font-style: italic">// Set the corresponding value</span>
        values<span style="color: #666666">[</span>i<span style="color: #666666">]</span> <span style="color: #666666">=</span> value<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Interface for serializing a Record.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">interface</span> <span style="color: #0000FF; font-weight: bold">RecordFormat</span> <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Writes a Record to a byte array.</span>
<span style="color: #408080; font-style: italic">     * @param record Record to write.</span>
<span style="color: #408080; font-style: italic">     * @return Array of bytes.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> <span style="color: #0000FF">writeRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> Record record<span style="color: #666666">);</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Reads a Record from an array of bytes.</span>
<span style="color: #408080; font-style: italic">     * @param fields Fields to look for.</span>
<span style="color: #408080; font-style: italic">     * @param bytes Array of bytes to read.</span>
<span style="color: #408080; font-style: italic">     * @return Record that was read.</span>
<span style="color: #408080; font-style: italic">     */</span>
    Record <span style="color: #0000FF">readRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> Field<span style="color: #666666">[]</span> fields<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">byte</span><span style="color: #666666">[]</span> bytes<span style="color: #666666">);</span>
<span style="color: #666666">}</span>
<span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic"> * Table class for DBMS.</span>
<span style="color: #408080; font-style: italic"> *</span>
<span style="color: #408080; font-style: italic"> * Abstracts away some of the Table management features from the AccessManager.</span>
<span style="color: #408080; font-style: italic"> */</span>
<span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Table</span> <span style="color: #666666">{</span>
    <span style="color: #408080; font-style: italic">/** List of Fields in the Table. */</span>
    <span style="color: #008000; font-weight: bold">private</span> Fields<span style="color: #666666">[]</span> fields<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Mapping from Record ID to Page ID. */</span>
    <span style="color: #008000; font-weight: bold">private</span> HashMap<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">,</span> Integer<span style="color: #666666">&gt;</span> recordToPage<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** The PageFormat to use when placing a Record into a Page. */</span>
    <span style="color: #008000; font-weight: bold">private</span> PageFormat pageFormat<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** The RecordFormat to use when writing a Record. */</span>
    <span style="color: #008000; font-weight: bold">private</span> RecordFormat recordFormat<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Array of all the full Page IDs. */</span>
    <span style="color: #008000; font-weight: bold">private</span> ArrayList<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">&gt;</span> fullPages<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/** Array of all the full Page IDs. */</span>
    <span style="color: #008000; font-weight: bold">private</span> ArrayList<span style="color: #666666">&lt;</span>Integer<span style="color: #666666">&gt;</span> nonFullPages<span style="color: #666666">;</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Creates a new Table.</span>
<span style="color: #408080; font-style: italic">     * @param givenFields Fields to create.</span>
<span style="color: #408080; font-style: italic">     * @param givenPageFormat PageFormat to use.</span>
<span style="color: #408080; font-style: italic">     * @param givenRecordFormat RecordFormat to use.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #0000FF">Table</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> Fields<span style="color: #666666">[]</span> givenFields<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> PageFormat givenPageFormat<span style="color: #666666">,</span>
            <span style="color: #008000; font-weight: bold">final</span> RecordFormat givenRecordFormat<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">// Set the values</span>
        fields <span style="color: #666666">=</span> givenFields<span style="color: #666666">;</span>
        pageFormat <span style="color: #666666">=</span> givenPageFormat<span style="color: #666666">;</span>
        recordFormat <span style="color: #666666">=</span> givenRecordFormat<span style="color: #666666">;</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Deletes all the Pages being used up by the Table.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">delete</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #408080; font-style: italic">// Iterate over all the Pages, deleting them one by one</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>Integer pid <span style="color: #666666">:</span> recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">values</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">deletePage</span><span style="color: #666666">(</span>pid<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Reads a Record from the Table.</span>
<span style="color: #408080; font-style: italic">     * @param rid Record ID to read.</span>
<span style="color: #408080; font-style: italic">     * @return Record that was read.</span>
<span style="color: #408080; font-style: italic">     * @throws DBMSException on any error.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> Record <span style="color: #0000FF">readRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">)</span> <span style="color: #008000; font-weight: bold">throws</span> DBMSException <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">contains</span><span style="color: #666666">(</span>rid<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            <span style="color: #B00040">int</span> pid <span style="color: #666666">=</span> recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">get</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>

            Page page <span style="color: #666666">=</span> DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">readPage</span><span style="color: #666666">(</span>pid<span style="color: #666666">);</span>

            page<span style="color: #666666">.</span><span style="color: #7D9029">setPageFormat</span><span style="color: #666666">(</span>pageFormat<span style="color: #666666">);</span>
            page<span style="color: #666666">.</span><span style="color: #7D9029">setRecordFormat</span><span style="color: #666666">(</span>recordFormat<span style="color: #666666">);</span>

            <span style="color: #008000; font-weight: bold">return</span> page<span style="color: #666666">.</span><span style="color: #7D9029">retrieveRecord</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #0000FF">DBMSException</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;Table does not contain record &quot;</span> <span style="color: #666666">+</span> rid<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Writes a given Record to the Table.</span>
<span style="color: #408080; font-style: italic">     * @param rid Record ID to write.</span>
<span style="color: #408080; font-style: italic">     * @param record Record object to write.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">writeRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">,</span> <span style="color: #008000; font-weight: bold">final</span> Record record<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        Page page<span style="color: #666666">;</span>

        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">contains</span><span style="color: #666666">(</span>rid<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            <span style="color: #B00040">int</span> pid <span style="color: #666666">=</span> recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">get</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>

            page <span style="color: #666666">=</span> DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">readPage</span><span style="color: #666666">(</span>pid<span style="color: #666666">);</span>

            page<span style="color: #666666">.</span><span style="color: #7D9029">setPageFormat</span><span style="color: #666666">(</span>pageFormat<span style="color: #666666">);</span>
            page<span style="color: #666666">.</span><span style="color: #7D9029">setRecordFormat</span><span style="color: #666666">(</span>recordFormat<span style="color: #666666">);</span>

            page<span style="color: #666666">.</span><span style="color: #7D9029">writeRecord</span><span style="color: #666666">(</span>record<span style="color: #666666">);</span>
        <span style="color: #666666">}</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">{</span>
            <span style="color: #408080; font-style: italic">// We need a Page with space</span>
            page <span style="color: #666666">=</span> nextAvailablePage<span style="color: #666666">();</span>

            page<span style="color: #666666">.</span><span style="color: #7D9029">setPageFormat</span><span style="color: #666666">(</span>pageFormat<span style="color: #666666">);</span>
            page<span style="color: #666666">.</span><span style="color: #7D9029">setRecordFormat</span><span style="color: #666666">(</span>recordFormat<span style="color: #666666">);</span>

            <span style="color: #408080; font-style: italic">// Save the Record to the Page</span>
            page<span style="color: #666666">.</span><span style="color: #7D9029">writeRecord</span><span style="color: #666666">(</span>record<span style="color: #666666">);</span>

            <span style="color: #408080; font-style: italic">// Store location of the Record</span>
            recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">put</span><span style="color: #666666">(</span>rid<span style="color: #666666">,</span> page<span style="color: #666666">.</span><span style="color: #7D9029">getPageID</span><span style="color: #666666">());</span>
        <span style="color: #666666">}</span>

        <span style="color: #408080; font-style: italic">// Update our Heap of Pages</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(</span>page<span style="color: #666666">.</span><span style="color: #7D9029">isFull</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
            nonFullPages<span style="color: #666666">.</span><span style="color: #7D9029">remove</span><span style="color: #666666">(</span>page<span style="color: #666666">);</span>
            fullPages<span style="color: #666666">.</span><span style="color: #7D9029">add</span><span style="color: #666666">(</span>page<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Deletes a Record from the Table.</span>
<span style="color: #408080; font-style: italic">     * @param rid Record ID to delete.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">public</span> <span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">void</span> <span style="color: #0000FF">deleteRecord</span><span style="color: #666666">(</span><span style="color: #008000; font-weight: bold">final</span> <span style="color: #B00040">int</span> rid<span style="color: #666666">)</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(!</span>recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">contains</span><span style="color: #666666">(</span>rid<span style="color: #666666">))</span> <span style="color: #666666">{</span>
            <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #0000FF">DBMSException</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;Table does not contain record &quot;</span> <span style="color: #666666">+</span> rid<span style="color: #666666">);</span>
        <span style="color: #666666">}</span>

        <span style="color: #408080; font-style: italic">// Find out where the Record is</span>
        <span style="color: #B00040">int</span> pid <span style="color: #666666">=</span> recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">get</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Read the Page from disk</span>
        Page page <span style="color: #666666">=</span> DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">readPage</span><span style="color: #666666">(</span>pid<span style="color: #666666">);</span>

        page<span style="color: #666666">.</span><span style="color: #7D9029">setPageFormat</span><span style="color: #666666">(</span>pageFormat<span style="color: #666666">);</span>
        page<span style="color: #666666">.</span><span style="color: #7D9029">setRecordFormat</span><span style="color: #666666">(</span>recordFormat<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Delete the Record</span>
        page<span style="color: #666666">.</span><span style="color: #7D9029">deleteRecord</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>

        <span style="color: #408080; font-style: italic">// Update our mapping</span>
        recordToPage<span style="color: #666666">.</span><span style="color: #7D9029">remove</span><span style="color: #666666">(</span>rid<span style="color: #666666">);</span>
    <span style="color: #666666">}</span>

    <span style="color: #408080; font-style: italic">/**</span>
<span style="color: #408080; font-style: italic">     * Helper method to get the next available Page with space.</span>
<span style="color: #408080; font-style: italic">     * @return Page with space.</span>
<span style="color: #408080; font-style: italic">     */</span>
    <span style="color: #008000; font-weight: bold">private</span> Page <span style="color: #0000FF">nextAvailablePage</span><span style="color: #666666">()</span> <span style="color: #666666">{</span>
        <span style="color: #008000; font-weight: bold">for</span> <span style="color: #666666">(</span>Integer pid <span style="color: #666666">:</span> nonFullPages<span style="color: #666666">)</span> <span style="color: #666666">{</span>
            Page page <span style="color: #666666">=</span> DiskManager<span style="color: #666666">.</span><span style="color: #7D9029">readPage</span><span style="color: #666666">(</span>pid<span style="color: #666666">);</span>

            page<span style="color: #666666">.</span><span style="color: #7D9029">setPageFormat</span><span style="color: #666666">(</span>pageFormat<span style="color: #666666">);</span>
            page<span style="color: #666666">.</span><span style="color: #7D9029">setRecordFormat</span><span style="color: #666666">(</span>recordFormat<span style="color: #666666">);</span>

            <span style="color: #008000; font-weight: bold">if</span> <span style="color: #666666">(!</span>page<span style="color: #666666">.</span><span style="color: #7D9029">isFull</span><span style="color: #666666">())</span> <span style="color: #666666">{</span>
                <span style="color: #008000; font-weight: bold">return</span> page<span style="color: #666666">;</span>
            <span style="color: #666666">}</span>
        <span style="color: #666666">}</span>

        <span style="color: #008000; font-weight: bold">throw</span> <span style="color: #0000FF">DBMSException</span><span style="color: #666666">(</span><span style="color: #BA2121">&quot;Table is full.&quot;</span><span style="color: #666666">);</span>
    <span style="color: #666666">}</span>
<span style="color: #666666">}</span>
</pre></div>
</body>
</html>
